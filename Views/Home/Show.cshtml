@{
    ViewData["Title"] = "Show";
}
@if (Convert.ToInt32(ViewData["Mode"]) == 1)
{
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body p-4">
            <form asp-controller="Home" asp-action="ListFeedback" method="post" class="d-flex align-items-end gap-3">
                <div class="flex-grow-1">
                    <label for="yearSelect" class="form-label fw-semibold text-muted mb-2">
                        <i class="bi bi-calendar-event"></i> Select Year
                    </label>
                    <select id="yearSelect" name="year" class="form-select form-select-lg border-2">
                        @for (var i = DateTime.Now.Year - 10; i <= DateTime.Now.Year + 10; ++i)
                        {
                            <option value="@i">@i</option>
                        }
                    </select>
                </div>
                <button type="submit" class="btn btn-primary btn-lg px-4">
                    <i class="bi bi-funnel"></i> Filter
                </button>
            </form>
        </div>
    </div>
}
else
{
    <div id="showTopPerforming" class="mb-4">
    </div>
    <div>
        <div>
           
            <div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="feedbackModalLabel">Delete feedback</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div style="display:none" id="idHolder"></div>
                            <p>Do you want to delete the feedback?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-danger" onclick="deleteFeedback(document.getElementById('idHolder').innerText)">Delete</button>
                        </div>
                    </div>
                </div>
            </div>

            
        </div>
        <div id="feedbackContainer"
        style="max-height:100vh; overflow-y: auto; padding-right: 10px; scrollbar-width: none; -ms-overflow-style: none;">
        
        </div>
    </div>
    <style>
        #feedbackContainer::-webkit-scrollbar {
            display: none;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function deleteFeedback(id){
            $.ajax({
                type: "POST",
                url: "/Home/DeleteFeedback",
                data: { id: id },
                success: function (response) {
                    var modal = bootstrap.Modal.getInstance(document.getElementById('feedbackModal'));
                    modal.hide();
                    fetchFeedbacks();
                },
                error: function (error) {
                    console.error("Error deleting feedback:", error);
                    alert("An error occurred while deleting the feedback.");
                }
            })
        }
        function fetchFeedbacks() {
            $.ajax({
                type: "GET",
                url: "/Home/GetFeedbacks",
                data: { year: "@ViewData["Year"]" },
                success: function (data) {
                    console.log(data);
                    $('#feedbackContainer').html('');
                    data.forEach(function (fb) {
                        var feedbackEntry = '';
                        if (fb.emojivalue == "1") {
                            feedbackEntry = `
                                <div onclick="var modal = new bootstrap.Modal(document.getElementById('feedbackModal')); modal.show();document.getElementById('idHolder').innerText='${fb.id}';" class="card mb-3" style="border-radius: 15px; border-left: 5px solid #28a745; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); position: relative; overflow: hidden; box-shadow: none; cursor: pointer;">
                                    <div style="position: absolute; top: -10px; left: 20%; font-size: 2rem; opacity: 0.3;">üéâ</div>
                                    <div style="position: absolute; bottom: -10px; right: 15%; font-size: 2.5rem; opacity: 0.3;">‚ú®</div>
                                    <div class="card-body position-relative">
                                        <h5 class="card-title text-success fw-bold">${fb.name}</h5>
                                        <p class="card-text text-muted">${fb.fb.substring(0, 100)}</p>
                                        <small class="text-success"><i class="bi bi-hand-thumbs-up-fill"></i> Positive Feedback</small>
                                    </div>
                                </div>
                                `;
                        }
                        else if (fb.emojivalue == "2") {
                            feedbackEntry = `
                                <div onclick="var modal = new bootstrap.Modal(document.getElementById('feedbackModal')); modal.show();document.getElementById('idHolder').innerText='${fb.id}';" class="card mb-3 " style="border-radius: 15px; border-left: 5px solid #ffc107; background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%); position: relative; overflow: hidden; box-shadow: none;">
                                    <div style="position: absolute; top: -10px; left: 20%; font-size: 2rem; opacity: 0.3;">üôÇ</div>
                                    <div style="position: absolute; bottom: -10px; right: 15%; font-size: 2.5rem; opacity: 0.3;">üåü</div>
                                    <div class="card-body position-relative">
                                        <h5 class="card-title text-warning fw-bold">${fb.name}</h5>
                                        <p class="card-text text-muted">${fb.fb.substring(0, 100)}</p>    
                                        <small class="text-warning"><i class="bi bi-hand-thumbs-up"></i> Neutral Feedback</small>
                                    </div>
                                </div>
                                `;
                        }
                        else if (fb.emojivalue == "3") {
                            feedbackEntry = `
                                <div onclick="var modal = new bootstrap.Modal(document.getElementById('feedbackModal')); modal.show();document.getElementById('idHolder').innerText='${fb.id}';" class="card mb-3" style="border-radius: 15px; border-left: 5px solid #ffc107; background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%); position: relative; overflow: hidden; box-shadow: none;">
                                    <div style="position: absolute; top: -10px; left: 20%; font-size: 2rem; opacity: 0.3;">üòê</div>
                                    <div style="position: absolute; bottom: -10px; right: 15%; font-size: 2.5rem; opacity: 0.3;">üåà</div>
                                    <div class="card-body position-relative">
                                        <h5 class="card-title text-warning fw-bold">${fb.name}</h5>
                                        <p class="card-text text-muted">${fb.fb.substring(0, 100)}</p>
                                        <small class="text-warning"><i class="bi bi-hand-thumbs-up"></i> Average Feedback</small>
                                    </div>
                                </div>`;
                        }
                        else if (fb.emojivalue == "4") {
                            feedbackEntry = `
                                <div onclick="var modal = new bootstrap.Modal(document.getElementById('feedbackModal')); modal.show();document.getElementById('idHolder').innerText='${fb.id}';" class="card mb-3" style="border-radius: 15px; border-left: 5px solid #dc3545; background: linear-gradient(135deg, #fff1f0 0%, #ffdddd 100%); position: relative; overflow: hidden; box-shadow: none;">
                                    <div style="position: absolute; top: -10px; left: 20%; font-size: 2rem; opacity: 0.3;">üòû</div>
                                    <div style="position: absolute; bottom: -10px; right: 15%; font-size: 2.5rem; opacity: 0.3;">üíî</div>
                                    <div class="card-body position-relative">
                                        <h5 class="card-title text-danger fw-bold">${fb.name}</h5>
                                        <p class="card-text text-muted">${fb.fb.substring(0, 100)}</p>
                                        <small class="text-danger"><i class="bi bi-hand-thumbs-down-fill"></i> Negative Feedback</small>
                                    </div>
                                </div>`;
                        }
                        $('#feedbackContainer').append(feedbackEntry);
                    });
                },
                error: function (error) {
                    console.error("Error fetching feedbacks:", error);
                }
            });
        }
        $(document).ready(() => {
            setInterval(() => {
                $.ajax({
                    type: "GET",
                    url: "/Home/GetTopPerforming",
                    data: { year: "@ViewData["Year"]" },
                    success: function (data) {
                        var topPerformingHtml = `
                            <div class="card shadow-sm border-0">
                                <div class="card-body p-4">
                                    <h5 class="card-title mb-3 fw-bold"><i class="bi bi-trophy-fill text-warning"></i> Top Performing Categories in @ViewData["Year"]</h5>
                                    <div class="d-flex flex-wrap justify-content-between" style="flex-wrap: nowrap; overflow-x: auto;">`;
                        data.forEach(function (item) {
                            if (item.emojiValue == 1) {
                                topPerformingHtml += `
                                    <div class="p-3 rounded shadow-sm text-center text-white position-relative overflow-hidden" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); flex: 0 0 auto; min-width: 200px; margin: 10px; animation: pulse 2s infinite;">
                                        <div style="position: absolute; top: -20px; left: 10%; font-size: 3rem; opacity: 0.2; animation: float 3s ease-in-out infinite;">üéâ</div>
                                        <div style="position: absolute; bottom: -15px; right: 10%; font-size: 2.5rem; opacity: 0.2; animation: float 3s ease-in-out infinite 0.5s;">‚ú®</div>
                                        <div class="position-relative">
                                            <h6 class="fw-semibold"><i class="bi bi-emoji-smile-fill"></i> Awesome</h6>
                                            <p class="display-6 fw-bold mb-0">${item.total}</p>
                                        </div>
                                    </div>`;
                            } else if (item.emojiValue == 2) {
                                topPerformingHtml += `
                                    <div class="p-3 rounded shadow-sm text-center position-relative overflow-hidden" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); flex: 0 0 auto; min-width: 200px; margin: 10px; animation: pulse 2s infinite;">
                                        <div style="position: absolute; top: -20px; left: 10%; font-size: 3rem; opacity: 0.2; animation: float 3s ease-in-out infinite;">üôÇ</div>
                                        <div style="position: absolute; bottom: -15px; right: 10%; font-size: 2.5rem; opacity: 0.2; animation: float 3s ease-in-out infinite 0.5s;">üåü</div>
                                        <div class="position-relative">
                                            <h6 style="color:#1F3A5F;" class="fw-semibold"><i class="bi bi-emoji-neutral-fill"></i> Good</h6>
                                            <p style="color:#1F3A5F;" class="display-6 fw-bold mb-0">${item.total}</p>
                                        </div>
                                    </div>`;
                            } else if (item.emojiValue == 3) {
                                topPerformingHtml += `
                                    <div class="p-3 rounded shadow-sm text-center position-relative overflow-hidden" style="background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%); flex: 0 0 auto; min-width: 200px; margin: 10px; animation: pulse 2s infinite;">
                                        <div style="position: absolute; top: -20px; left: 10%; font-size: 3rem; opacity: 0.3; animation: float 3s ease-in-out infinite;">üòê</div>
                                        <div style="position: absolute; bottom: -15px; right: 10%; font-size: 2.5rem; opacity: 0.3; animation: float 3s ease-in-out infinite 0.5s;">üåà</div>
                                        <div class="position-relative">
                                            <h6 style="color:black" class="fw-semibold"><i class="bi bi-emoji-expressionless"></i> Average</h6>
                                            <p style="color:black" class="display-6 fw-bold mb-0">${item.total}</p>
                                        </div>
                                    </div>`;
                            } else if (item.emojiValue == 4) {
                                topPerformingHtml += `
                                    <div class="p-3 rounded shadow-sm text-center text-white position-relative overflow-hidden" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); flex: 0 0 auto; min-width: 200px; margin: 10px; animation: pulse 2s infinite;">
                                        <div style="position: absolute; top: -20px; left: 10%; font-size: 3rem; opacity: 0.2; animation: float 3s ease-in-out infinite;">üòû</div>
                                        <div style="position: absolute; bottom: -15px; right: 10%; font-size: 2.5rem; opacity: 0.2; animation: float 3s ease-in-out infinite 0.5s;">üíî</div>
                                        <div class="position-relative">
                                            <h6 class="fw-semibold"><i class="bi bi-emoji-frown-fill"></i> Negative</h6>
                                            <p class="display-6 fw-bold mb-0">${item.total}</p>
                                        </div>
                                    </div>`;
                            }
                        });

                        if (!document.querySelector('style[data-animations]')) {
                            var style = document.createElement('style');
                            style.setAttribute('data-animations', 'true');
                            style.textContent = `
                                    @@keyframes pulse {
                                        0%, 100% { transform: scale(1); }
                                        50% { transform: scale(1.05); }
                                    }
                                    @@keyframes float {
                                        0%, 100% { transform: translateY(0px) rotate(0deg); }
                                        50% { transform: translateY(-15px) rotate(5deg); }
                                    }
                                `;
                            document.head.appendChild(style);
                        }
                        topPerformingHtml += `
                                    </div>
                                </div>  
                            </div>`;
                        $('#showTopPerforming').html(topPerformingHtml);

                    },
                    error: function (error) {
                        console.error("Error fetching top performing categories:", error);
                    }
                });
            }, 1000);
        })
        $(document).ready(function () {
            fetchFeedbacks();
            setInterval(fetchFeedbacks, 1000);
        });
    </script>
}